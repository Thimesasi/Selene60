units:
  # Proxy Spacing Variables
  kx: U
  ky: U
  # Padding Variables
  px: kx + 2
  py: ky + 2

# Stabalizer cutout
  u: U # Ensure we are using 19.05!
  stabilizer_width: 7
  stabilizer_height: 14
  stabilizer_offset: -1 # This means south stabs, use `orient` to rotate them for north facing scenarios
  stabilizer_spacing_2u: u / 2 + stabilizer_width / 2 + ((23.8 / 2) - (14 / 2) - (stabilizer_width / 2)) # The complex formula has two magic numbers. 14 is the size of a switch cutout for a plate. 23.8 is the distance between each stabilizer on a 2-2.75u stabilizer, as specified by Cherry
#Gasket dimensions
  gas_len: 45
  gas_wid: 5
  gas_spc: 69.476

points:
  zones:
    matrix:
      anchor:
        shift: [75, -175]
      columns:
        C1:
          rows.R1.skip: true
          key:
            column_net: P1
        C2:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
          key:
            column_net: P0
        C3:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
          key:
            column_net: P2
        C4:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
          key:
            column_net: P3
        C5:
          rows.R1.skip: true
          key:
            column_net: P4
        C6:
          rows.R1.width: 2kx
          key:
            column_net: P5
        C7:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
          key:
            column_net: P6
        C8:
          rows.R1.skip: true
          key:
            column_net: P7
        C9:
          rows.R1.width: 1.75kx
          rows.R1.shift: [-0.125kx,0]
          rows.R2.shift: [0.125kx,0]
          key:
            column_net: P8
        C10:
          rows.R1.skip: true
          key:
            column_net: P9
        C11:
          rows.R1.width: 1.25kx
          rows.R1.shift: [-0.625kx,0]
          rows.R2.shift: [0.625kx,0]
          key:
            column_net: P10
        C12:
          rows.R1.shift: [-0.5kx,0]
          rows.R2.shift: [0.5kx,0]
          key:
            column_net: P16
        C13:
          rows.R1.shift: [-0.5kx,0]
          rows.R2.shift: [0.5kx,0]
          key:
            column_net: P14
        C14:
          rows.R1.shift: [-0.5kx,0]
          rows.R2.shift: [0.5kx,0]
          rows.R4.skip: true
          key:
            column_net: P15
        C15:
          #backspace
          rows.R1.skip: true
          rows.R4.width: 2kx
          rows.R4.shift: [-0.5kx,0]
          rows.R5.shift: [0.5kx,0]

          #Enter
          rows.R3.skip: true
          rows.R2.height: 2ky
          rows.R2.shift: [0, 0.5ky]
          rows.R3.shift: [0, -0.5ky]
          key:
            column_net: P18

      rows:
        R1:
          row_net: P19
        R2:
          row_net: P20
        R3:
          row_net: P21
        R4:
          row_net: P101
        R5:
          row_net: P102
outlines:
  one_gasket:
    main:
      what: rectangle
      size: [gas_len,gas_wid]
      fillet: gas_wid/2 - 0.0001
    connect:
      what: rectangle
      size: [5,5]
      operation: add
      adjust:
        shift: [0,-2]
  one_gasket_small:
    main:
      what: rectangle
      size: [10,7]      
  top_gasket:
    mid:
      what: outline
      name: one_gasket
    right:
      what: outline
      name: one_gasket
      operation: add
      adjust:
        shift: [gas_spc,0]
    left:
      what: outline
      name: one_gasket
      operation: add
      adjust:
        shift: [-gas_spc,0]
  top_small_gaskets:      
    sleft:
      what: outline
      name: one_gasket_small
      adjust: 
        shift: [-100.501-25-7.5, 0]  
    sright:
      what: outline
      name: one_gasket_small
      adjust: 
        shift: [100.501+25+7.5,0]           
  2u_stabilizer:
    backspace_L:
      what: rectangle
      where: matrix_C15_R4
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [stabilizer_spacing_2u, -stabilizer_offset]
    backspace_R:
      what: rectangle
      where: matrix_C15_R4
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [-stabilizer_spacing_2u, -stabilizer_offset]
    space_L:
      what: rectangle
      where: matrix_C6_R1
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [stabilizer_spacing_2u, -stabilizer_offset]
    space_R:
      what: rectangle
      where: matrix_C6_R1
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [-stabilizer_spacing_2u, -stabilizer_offset]
    enter_T:
      what: rectangle
      where: matrix_C15_R2
      size: [stabilizer_height, stabilizer_width]
      adjust:
        shift: [stabilizer_offset, -stabilizer_spacing_2u]     
    enter_B:
      what: rectangle
      where: matrix_C15_R2
      size: [stabilizer_height, stabilizer_width]
      adjust:
        shift: [stabilizer_offset, stabilizer_spacing_2u]             
  keys:
    main: 
      what: rectangle
      where: true
      size: [kx-1, ky-1]
  border:
    main: 
      what: rectangle
      where: true
      size: [px, py]
    spacebarL:
      what: rectangle
      where: matrix_C6_R1
      size: [2px - (px - kx), py]
      operation: add
    spacebarR:
      what: rectangle
      where: matrix_C9_R1
      size: [2px - (px - kx), py]
      operation: add  
    backspaceBot:
      what: rectangle
      where: matrix_C11_R1
      size: [2px - (px - kx), py]
      operation: add  
    enter:
      what: rectangle
      where: matrix_C15_R2
      size: [px, 2py - (py-ky)]
    backspaceTop:
      what: rectangle
      where: matrix_C15_R4
      size: [2px - (px - kx), py]
      operation: add
  plate:
    main:
      what: outline
      name: border
    keys:
      what: rectangle
      where: /^matrix_.*/
      size: [14, 14]
      operation: subtract
    stabs:
      what: outline
      name: 2u_stabilizer
      operation: subtract
  board:
    main:
      what: outline
      name: border  
    gaskettop:
      what: outline
      name: top_gasket
      where: matrix_C8_R5
      operation: add
      adjust:
        shift: [0, kx-5.5]
      fillet: 0.2  
    gasketbot:
      what: outline
      name: top_gasket
      where: matrix_C8_R5
      operation: add
      adjust:
        rotate: 180
        shift: [0, -5kx+5.5]
      fillet: 0.2  
    gasketsmalltop:
      what: outline
      name: top_small_gaskets
      where: matrix_C8_R5
      operation: add
      adjust:
        shift: [0, kx-6.5]
      fillet: 0.5  
    gasketsmallbot:
      what: outline
      name: top_small_gaskets
      where: matrix_C8_R5
      operation: add
      adjust:
        shift: [0, -4kx+6.5]
      fillet: 0.5      
          
  preview:
    main:
      what: outline
      name: keys
    layer:
      what: outline
      name: board
      operation: stack   
pcbs:
  selene:
    template: kicad8
    outlines:
      main:
        outline: board
    footprints:
      stab_space:
        what: stab_2u
        where: /^matrix_(?:C6_R1)/

      stab_bspc:
        what: stab_2u
        where: /^matrix_(?:C15_R4)/
        
      stab_enter:
        what: stab_2u
        where: /^matrix_(?:C15_R2)/
        adjust:
          rotate: 90
      mx_hotswap_main:
        what: ceoloide/switch_mx
        where: /^matrix_(?!(?:C7_R1))/
        params:
          from: "{{column_net}}"
          to: "{{colrow}}"
          include_keycap: true
          include_corner_marks: true
          hotswap: true 
      # Rotate switch socket so it does't conflict with controller    
      mx_hotswap_conflict:
        what: ceoloide/switch_mx
        where: /^matrix_(?:C7_R1)/
        params:
          from: "{{column_net}}"
          to: "{{colrow}}"
          include_keycap: true
          include_corner_marks: true
          hotswap: true 
        adjust:
            rotate: 90     
      diode:
        what: ceoloide/diode_tht_sod123
        where: /^matrix_(?!(?:C7_R1|C9_R1|C8_R3))/
        adjust:
          rotate: 90
          shift: [ 7, -4 ]
        params:
          side: B
          from: "{{colrow}}"
          to: "{{row_net}}"
      # Move diodes so it does't conflict with controller
      diode_conflict1:
        what: ceoloide/diode_tht_sod123
        where: /^matrix_(?:C7_R1)/
        adjust:
          rotate: 0
          shift: [5, -8]
        params:
          side: B
          from: "{{colrow}}"
          to: "{{row_net}}"
      diode_conflict2:
        what: ceoloide/diode_tht_sod123
        where: /^matrix_(?:C9_R1)/
        adjust:
          rotate: 0
          shift: [0, -9]
        params:
          side: B
          from: "{{colrow}}"
          to: "{{row_net}}"  
      # Move diode that conflicts with JST connector      
      diode_conflict3:
        what: ceoloide/diode_tht_sod123
        where: /^matrix_(?:C8_R3)/
        adjust:
          rotate: -90
          shift: [-5, -5]
        params:
          side: B
          from: "{{colrow}}"
          to: "{{row_net}}"      

      mcu:
        what: ceoloide/mcu_supermini_nrf52840
        params:
          side: B
          include_extra_pins: true
        where:
          ref: matrix_C9_R1
          shift: [2, 2]
          rotate: 90
      jstph:
        what: ceoloide/battery_connector_jst_ph_2
        where:
          ref.aggregate.parts: [matrix_C8_R2, matrix_C8_R3, matrix_C9_R2, matrix_C9_R3]
          shift: [0,3]
          rotate: -90
        params:
            side: B
      power:
        what: ceoloide/power_switch_smd_side
        where: matrix_C15_R4
        params:
          side: B
        adjust:
          shift: [kx-2,0]
          rotate: 0
      reset:
        what: ceoloide/reset_switch_smd_side
        where: matrix_C15_R2
        params:
          side: B
        adjust:
          shift: [0,-kx+2]
          rotate: 180
    

