units:
  # Proxy Spacing Variables
  kx: U
  ky: U
  # Padding Variables
  px: kx + 2
  py: ky + 2

# Stabalizer cutout
  u: U # Ensure we are using 19.05!
  stabilizer_width: 7
  stabilizer_height: 14
  stabilizer_offset: -1 # This means south stabs, use `orient` to rotate them for north facing scenarios
  stabilizer_spacing_2u: u / 2 + stabilizer_width / 2 + ((23.8 / 2) - (14 / 2) - (stabilizer_width / 2)) # The complex formula has two magic numbers. 14 is the size of a switch cutout for a plate. 23.8 is the distance between each stabilizer on a 2-2.75u stabilizer, as specified by Cherry

points:
  zones:
    matrix:
      anchor:
        shift: [75, -175]
      columns:
        C1:
          rows.R1.skip: true
        C2:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
        C3:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
        C4:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
        C5:
          rows.R1.skip: true
        C6:
          rows.R1.width: 2kx
        C8:
          rows.R1.shift: [0.5kx,0]
          rows.R2.shift: [-0.5kx,0]
        C7:
          rows.R1.skip: true
        C9:
          rows.R1.width: 1.75kx
          rows.R1.shift: [-0.125kx,0]
          rows.R2.shift: [0.125kx,0]
        C10:
          rows.R1.skip: true
        C11:
          rows.R1.width: 1.25kx
          rows.R1.shift: [-0.625kx,0]
          rows.R2.shift: [0.625kx,0]
        C12:
          rows.R1.shift: [-0.5kx,0]
          rows.R2.shift: [0.5kx,0]
        C13:
          rows.R1.shift: [-0.5kx,0]
          rows.R2.shift: [0.5kx,0]
        C14:
          rows.R1.shift: [-0.5kx,0]
          rows.R2.shift: [0.5kx,0]
          rows.R4.skip: true
        C15:
          #backspace
          rows.R1.skip: true
          rows.R4.width: 2kx
          rows.R4.shift: [-0.5kx,0]
          rows.R5.shift: [0.5kx,0]

          #Enter
          rows.R3.skip: true
          rows.R2.height: 2ky
          rows.R2.shift: [0, 0.5ky]
          rows.R3.shift: [0, -0.5ky]

      rows:
        R1:
        R2:
        R3:
        R4:
        R5:
outlines:
  2u_stabilizer:
    backspaceTop_L:
      what: rectangle
      where: matrix_C15_R4
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [stabilizer_spacing_2u, stabilizer_offset]
    backspaceTop_R:
      what: rectangle
      where: matrix_C15_R4
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [-stabilizer_spacing_2u, stabilizer_offset]
    backspaceBot_L:
      what: rectangle
      where: matrix_C6_R1
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [stabilizer_spacing_2u, stabilizer_offset]
    backspaceBot_R:
      what: rectangle
      where: matrix_C6_R1
      size: [stabilizer_width, stabilizer_height]
      adjust:
        shift: [-stabilizer_spacing_2u, stabilizer_offset]
    enter_T:
      what: rectangle
      where: matrix_C15_R2
      size: [stabilizer_height, stabilizer_width]
      adjust:
        shift: [stabilizer_offset, -stabilizer_spacing_2u]     
    enter_B:
      what: rectangle
      where: matrix_C15_R2
      size: [stabilizer_height, stabilizer_width]
      adjust:
        shift: [stabilizer_offset, stabilizer_spacing_2u]             
  keys:
    main: 
      what: rectangle
      where: true
      size: [kx-1, ky-1]
  border:
    main: 
      what: rectangle
      where: true
      size: [px, py]
    spacebarL:
      what: rectangle
      where: matrix_C6_R1
      size: [2px - (px - kx), py]
      operation: add
    spacebarR:
      what: rectangle
      where: matrix_C9_R1
      size: [2px - (px - kx), py]
      operation: add  
    backspaceBot:
      what: rectangle
      where: matrix_C11_R1
      size: [2px - (px - kx), py]
      operation: add  
    enter:
      what: rectangle
      where: matrix_C15_R2
      size: [px, 2py - (py-ky)]
    backspaceTop:
      what: rectangle
      where: matrix_C15_R4
      size: [2px - (px - kx), py]
      operation: add
  plate:
    main:
      what: outline
      name: border
    keys:
      what: rectangle
      where: /^matrix_.*/
      size: [14, 14]
      operation: subtract
    stabs:
      what: outline
      name: 2u_stabilizer
      operation: subtract
  preview:
    main:
      what: outline
      name: keys
    layer:
      what: outline
      name: border
      operation: stack

pcbs:
  selene:
    template: kicad8
    outlines:
      main:
        outline: border
    footprints:
      mx_hotswap_main:
        what: mx
        where: /^matrix_(?!(?:C7_R2|C7_R3|C8_R2|C8_R3))/
        params:
          from: "{{colrow}}"
          to: "{{column_net}}"
          keycaps: true
          hotswap: true
      # Rotate switch socket so it does't conflict with controller    
      mx_hotswap_conflict:
        what: mx
        where: /^matrix_(?:C7_R2|C7_R3|C8_R2|C8_R3)/
        params:
          from: "{{colrow}}"
          to: "{{column_net}}"
          keycaps: true
          hotswap: true 
        adjust:
            rotate: 90     
      diode:
        what: diode
        where: /^matrix_(?!(?:C7_R2|C7_R3|C8_R2|C8_R3))/
        adjust:
          rotate: 0
          shift: [ 0, -5 ]
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
      # Rotate diode so it does't conflict with controller
      diode_conflict1:
        what: diode
        where: /^matrix_(?:C7_R2|C7_R3)/
        adjust:
          rotate: 90
          shift: [8, 0 ]
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"
      diode_conflict2:
        what: diode
        where: /^matrix_(?:C8_R2|C8_R3)/
        adjust:
          rotate: 90
          shift: [4, 0 ]
        params:
          from: "{{colrow}}"
          to: "{{row_net}}"    

      nicenano:
        what: nice_nano
        params:
          orientation: up
        where:
          ref.aggregate.parts: [matrix_C8_R3, matrix_C9_R3]
          shift: [-3.25, -ky/2-1.25]
          rotate: -90
